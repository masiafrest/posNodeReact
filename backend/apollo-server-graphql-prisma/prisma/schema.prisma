// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Cliente {
  id        Int      @id @default(autoincrement())
  nombre    String?
  email     String   @unique
  telefono  String?
  dirrecion String?
  createdAt DateTime @default(now())
  venta     Venta?
}

model Usuario {
  id        Int      @id @default(autoincrement())
  nombre    String
  password  String
  rol       Rol      @default(VENDEDOR)
  venta     Venta?
  createdAt DateTime @default(now())
}

enum Rol {
  VENDEDOR
  ADMIN
}

model Item {
  id          Int         @id @default(autoincrement())
  marca       String
  modelo      String
  barcode     Int?
  image_url   String?
  sku         String?
  qty         Int
  descripcion String?
  precio      Precio?
  // precio Precio @relation(fields: [precioId], references: [id])
  // precioId Int
  ubicacion   Ubicacion   @relation(fields: [ubicacionId], references: [id])
  ubicacionId Int
  categorias  Categoria[]
  createdAt   DateTime    @default(now())
  deleted     Boolean     @default(false)
  tsvector  Unsupported("tsvector")? @default(dbgenerated()) 

  // @@index([tsvector])
  @@unique([marca, modelo, barcode])
}

model Categoria {
  id        Int      @id @default(autoincrement())
  nombre    String   @unique
  item      Item[]
  createdAt DateTime @default(now())
}

model Precio {
  id        Int      @id @default(autoincrement())
  precio    Decimal  @db.Decimal(5, 2)
  precioMin Decimal  @db.Decimal(5, 2)
  // item Item?
  item      Item     @relation(fields: [itemId], references: [id])
  itemId    Int
  createdAt DateTime @default(now())
}

model Ubicacion {
  id        Int      @id @default(autoincrement())
  dirrecion String
  tipo      String
  items     Item[]
  createdAt DateTime @default(now())

  @@unique([dirrecion, tipo])
}

model Venta {
  id        Int      @id @default(autoincrement())
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  usuarioId Int
  cliente   Cliente  @relation(fields: [clienteId], references: [id])
  clienteId Int
  Fecha     DateTime @default(now())
  credito   Boolean
  subTotal  Decimal  @db.Decimal(4, 2)
  tax       Decimal  @db.Decimal(4, 2)
  total     Decimal  @db.Decimal(4, 2)
}
